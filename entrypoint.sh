#!/bin/sh
set -e

echo "========================================"
echo "π€ μ΅λ§λ¦¬ Spring μ„λ²„ μ‹μ‘"
echo "========================================"

############################################
# 1) μ‹¤ν–‰ ν”„λ΅ν•„ μ„¤μ •
############################################
if [ -z "$SPRING_PROFILES_ACTIVE" ]; then
  echo "[WARN] SPRING_PROFILES_ACTIVE κ°’μ΄ λΉ„μ–΄μμµλ‹λ‹¤."
  echo "[INFO] κΈ°λ³Έκ°’(local) ν”„λ΅ν•„λ΅ μ‹¤ν–‰ν•©λ‹λ‹¤."
  SPRING_PROFILES_ACTIVE="local"
else
  echo "[INFO] κ°μ§€λ μ‹¤ν–‰ ν”„λ΅ν•„: $SPRING_PROFILES_ACTIVE"
fi

############################################
# 2) JAR νμΌ μ΅΄μ¬ ν™•μΈ
############################################
if [ ! -f "/app/app.jar" ]; then
  echo "[ERROR] /app/app.jar νμΌμ„ μ°Ύμ„ μ μ—†μµλ‹λ‹¤."
  echo "[ERROR] Dockerfile COPY κ²½λ΅λ‚ λΉλ“ κ²°κ³Όλ¬Όμ„ ν™•μΈν•μ„Έμ”."
  exit 1
fi
echo "[INFO] app.jar νμΌ ν™•μΈλ¨."


############################################
# 3) JVM μµμ… μ„¤μ •
############################################
JAVA_OPTS="${JAVA_OPTS:-}"
echo "[INFO] μ μ©λλ” JAVA_OPTS: \"$JAVA_OPTS\""

############################################
# 4) μ‹¤ν–‰ μ •λ³΄ μ”μ•½
############################################
echo "--------------- μ‹¤ν–‰ μ •λ³΄ μ”μ•½ ---------------"
echo "[ν”„λ΅ν•„] : $SPRING_PROFILES_ACTIVE"
echo "[JVM μµμ…] : $JAVA_OPTS"
echo "[JDK λ²„μ „] :"
java -version
echo "---------------------------------------------"

############################################
# 5) Spring Boot μ• ν”λ¦¬μΌ€μ΄μ… μ‹¤ν–‰
############################################
echo "[INFO] Spring Boot λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤..."
exec java \
  $JAVA_OPTS \
  -Dspring.profiles.active="$SPRING_PROFILES_ACTIVE" \
  -jar /app/app.jar
